---
layout: html.njk
pagination:
  data: beancounter.users
  size: 1
  alias: member
  resolve: values
permalink: 'share/{{ member.username | hash }}/index.html'

sectionHeight: 50vh
downstairsCost: 2.1
costaCost: 3.2
---

{% set totalCups = member.cups | sumRecords %}
{% set totalBeans = (member.beans | sumRecords) / 1000 %}
{% set totalBags = member.beans.length %}
{% set costPerCup = totalBeans * config.pricePerKilogram / totalCups %}

{% macro latte2() %}
<svg viewBox="0 0 19.66 71.78" style="transform: scale(1.5);">
  <use xlink:href="/assets/img/latte-art-2.svg#art"></use>
</svg>
{% endmacro %}

<main>
  <center-layout>
    <stack-layout space="s4">
      <cluster-layout space="s1" align="center" justify="center">
        <svg height="100" viewBox="0 0 120 170">
          <use xlink:href="/assets/img/latte-art-1.svg#art"></use>
        </svg>
        <header class="pageHeader">
          <h1>{{ site.title }}</h1>
          <p>It's <em>bean</em> a year to remember!</p>
        </header>
      </cluster-layout>

      <cover-layout centered="center-layout" space="0" minHeight="{{ sectionHeight }}">
        <center-layout intrinsic>
          <usage-planet
            image="{{ headshots[member.username] }}"
            endpoint="./usage.json"
          ></usage-planet>
        </center-layout>
        <details class="hint">
          <summary>info</summary>
          <p>That's each of your coffees going through the year and your beans too. They're going around in order going from January to December, so you might spot some habbits. The cups are aligned vertically so you can see how far through the day they are.</p>
        </details>
      </cover-layout>
      
      <cover-layout centered="section" space="0" minHeight="{{ sectionHeight }}">
        <section class="textStats flow">
          {% if totalCups === 0 %}
          <p>You didn't drink any coffee this year.</p>
          {% else %}
          <p>
            You had <span class="coolStat">{{ totalCups | formatCups }}</span> of coffee,
            that's about <fun-metric type="volume" value="{{ totalCups * config.cupVolume }}"></fun-metric>.
          </p>
          {% endif %}
          
          {% if totalBeans == 0 %}
          <p>You didn't buy any coffee this year.</p>
          {% else %}
          <p>
            You bought <span class="coolStat">{{ totalBeans | formatBeans }}</span> of beans.
            That's about <fun-metric type="weight" value="{{ totalBeans }}"></fun-metric>
            or <fun-metric type="length" value="{{ totalBeans * config.beansPerKilogram * config.beanLength }}"></fun-metric> if you lined up all the beans.
          </p>
          <p>
            On average each cup of coffee cost you 
            <span class="coolStat">{{ costPerCup | formatCost }}</span>.

            That's <span class="coolStat">{{ (downstairsCost / costPerCup).toFixed(0) }} ×</span> cheaper than downstairs. Those same coffees would have cost you <span class="coolStat">£{{ (totalCups * costaCost).toFixed(2) }}</span> at Costa!
          </p>
          {% endif %}
        </section>
      </cover-layout>
      
      <cover-layout centered="section" space="0" minHeight="{{ sectionHeight }}">
        <section class="flow">
          <h2>
            <icon-layout>
              {{ latte2() }}
              Coffees habbits
            </icon-layout>
          </h2>
          <switcher-layout limit="5">
            <div class="dayCard">
              <header>MON</header>
              <span class="coolStat">
                {{ member.cups | dailyAverage(1) | formatCups }}
              </span>
            </div>
            <div class="dayCard">
              <header>TUE</header>
              <span class="coolStat">
                {{ member.cups | dailyAverage(2) | formatCups }}
              </span>
            </div>
            <div class="dayCard">
              <header>WED</header>
              <span class="coolStat">
                {{ member.cups | dailyAverage(3) | formatCups }}
              </span>
            </div>
            <div class="dayCard">
              <header>THU</header>
              <span class="coolStat">
                {{ member.cups | dailyAverage(4) | formatCups }}
              </span>
            </div>
            <div class="dayCard">
              <header>FRI</header>
              <span class="coolStat">
                {{ member.cups | dailyAverage(5) | formatCups }}
              </span>
            </div>
          </switcher-layout>
          <hourly-graph endpoint="./hourly-cups.json"></hourly-graph>
        </section>
        <details class="hint">
          <summary>info</summary>
          <p>Here is your average number of coffees for each day of the week and a graph of when each of your coffees were as hours in the day.</p>
        </details>
      </cover-layout>
      
      {% if totalCups > 0 %}
      <cover-layout centered="section" space="0" minHeight="{{ sectionHeight }}">
        <section class="flow">
          <h2>
            <icon-layout>
              {{ latte2() }}
              Your coffees this year
            </icon-layout>
          </h2>
          <cups-graph endpoint="./monthly-cups.json"></cups-graph>
        </section>
        <details class="hint">
          <summary>info</summary>
          <p>This is all your coffees in the year, grouped by the month you drank them.</p>
        </details>
      </cover-layout>
      {% endif %}
      
      {% if totalBeans > 0 %}
      <cover-layout centered="section" space="0" minHeight="{{ sectionHeight }}">
        <section class="flow">
          <h2>
            <icon-layout>
              {{ latte2() }}
              Your purchases
            </icon-layout>
          </h2>
          <beans-graph endpoint="./monthly-beans.json"></beans-graph>
        </section>
        <details class="hint">
          <summary>info</summary>
          <p>Here is which months you purchased coffee beans.</p>
        </details>
      </cover-layout>
      {% endif %}
      
      {% if peers.goodies.length > 0 %}
      <cover-layout centered="section" space="0" minHeight="{{ sectionHeight }}">
        <section class="flow">
          <p>
            Your coffee comrade is ... <span class="coolStat">{{ peers.goodies[0].username }}</span>,
            you shared <span class="coolStat">{{ peers.goodies[0].value }}</span> coffees together!
          </p>
        </section>
        <details class="hint">
          <summary>info</summary>
          <p>Your comrade is who you shared the most coffees with, people who had a coffee within 5 minutes of you.</p>
        </details>
      </cover-layout>
      {% endif %}
      
      {% if peers.baddies.length > 0 %}
      <cover-layout centered="section" space="0" minHeight="{{ sectionHeight }}">
        <section class="flow">
          <h2 class="text-align:center">Your coffee nemesis</h2>
          <figure>
            <nemesis-frame headshot="{{ headshots[peers.baddies[0].username] }}"></nemesis-frame>
            <figcaption>You avoided each other on {{ peers.baddies[0].value }} days.</figcaption>
          </figure>
        </section>
        <details class="hint">
          <summary>info</summary>
          <p>Your nemesis is the person who you had the most coffees on the same day but not within 5 minutes of each other.</p>
        </details>
      </cover-layout>
      {% endif %}

      <pre id="data" aria-hidden="true"></pre>
    </stack-layout>
  </center-layout>
</main>

{% include 'footer.njk' %}

<script type="module" src="/js/member.js"></script>
